<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,300italic,400italic,600' rel='stylesheet'
  type='text/css'>
<link href="//netdna.bootstrapcdn.com/font-awesome/3.1.1/css/font-awesome.css" rel="stylesheet">
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
  integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA=="
  crossorigin="anonymous" />
  <title>Wallet</title>
</head>

<body>


  <div class="main">

    <header style="background-color: #3a57af; color: whitesmoke;padding: 20px;">
      <!-- <h1>PayRoll</h1> -->


      <span id="history"><b>Transaction</b></span>
      <!-- <span id="transaction"><b>Transaction</b></span>
<span id="contact"><b>Contact</b></span> -->

    </header>
  </div>
  <div class='lab'>
  <label class="senderss" for="sender"><i class="fas fa-user"></i></label>
    <span type="text" name="sender2" id="sender2"></span>
    <span id="amt"></span><br>
  </div>

  <div class="top" style="margin-left: 380px;">
    <div class="payment">Payment Details &nbsp;&nbsp;&nbsp;<i class="fas fa-credit-card"></i></div>
    </div>
  <form action="wallet.html" method="get" class=" group log-forms">
    <label id="icon" for="sender"><i class="icon-envelope "></i></label>
    <input name="sender" id="sender" style=" width: 200px;
    height: 39px;
    -webkit-border-radius: 0px 4px 4px 0px/5px 5px 4px 4px;
    -moz-border-radius: 0px 4px 4px 0px/0px 0px 4px 4px;
    border-radius: 0px 4px 4px 0px/5px 5px 4px 4px;
    background-color: #fff;
    -webkit-box-shadow: 1px 2px 5px rgba(0, 0, 0, .09);
    -moz-box-shadow: 1px 2px 5px rgba(0, 0, 0, .09);
    box-shadow: 1px 2px 5px rgba(0, 0, 0, .09);
    border: solid 1px #cbc9c9;
    margin-left: -5px;
    margin-top: 13px;
    padding-left: 10px;"disabled>
    <button id="otp">Send otp</button><br><br>
    <label id="icon" for="otpVal"><i class="fas fa-key"></i></label>
    <input id="otpVal" type="number" placeholder="enter the otp">
    <button id="sub">submit</button><br>
    <p id="sent" style="color:red;font-size:15px"></p><br>
    <label id="icon" for="sender"><i class="icon-envelope "></i></label>
    <input type="text" name="receiver" id="receiver" placeholder="receiver"><br>
    <p id="recErr" style="color:red;font-size:15px;width: fit-content;"></p><br>
    <label id="icon" for="sender"> <i class="fas fa-rupee-sign"></i></label>
    <input type="number" name="amount" id="amount" placeholder="amount"><br>
    <p id="amountErr" style="color:red;font-size:15px;width: fit-content;"></p><br>
    <button id="sendCoins" hidden>Send</button>
  </form>

  <input id="otpvalue" hidden>




  <style>

    body,
        div,
        dl,
        dt,
        dd,
        ul,
        ol,
        li,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        pre,
        form,
        fieldset,
        input,
        textarea,
        p,
        blockquote,
        th,
        td {
            padding: 0;
            margin: 0;
        }

        .lab{
          padding:30px
        }

        .senderss{
          margin-left:30px;
          font-size: 27px;
          color: #3a57af;
          
        }

        #sender2{
          font-size: 27px;
          color: #3a57af;
        }

        fieldset,
        img {
            border: 0
        }

        ol,
        ul,
        li {
            list-style: none
        }

        :focus {
            outline: none
        }

       
        input,
        textarea,
        select {
            /* font-family: 'Open Sans', sans-serif; */
            font-size: 16px;
            color: #181818;
        }



        p {
            font-size: 12px;
            width: 150px;
            display: inline-block;
            margin-left: 18px;
        }

        


        .testbox {
            margin: 80px auto;
            width: 443px;
            height: 564px;
            -webkit-border-radius: 8px/7px;
            -moz-border-radius: 8px/7px;
            border-radius: 8px/7px;
            background-color: #ebebeb;
            -webkit-box-shadow: 5px 5px 5px rgba(0, 0, 0, .31);
            -moz-box-shadow: 5px 5px 5px rgba(0, 0, 0, .31);
            box-shadow: 10px 10px 5px rgba(0, 0, 0, .31);
            border: solid 1px white;
        }

        #otp {
            border: 1px solid #3a57af;
            padding: 10px;
            color: #3a57af;
            border-radius: 6%;
        }

        #otp:hover {
            color: white
        }

        #amt{
          margin-left:970px ;
          font-size: 27px;
          color: #3a57af;
        }

        #sub {
            border: 1px solid #3a57af;
            padding: 10px 18px;
            color: #3a57af;
            border-radius: 6%;
        }

        #sub:hover {
            color: white
        }

        #show {
            border: 1px solid #3a57af;
            padding: 10px 29px;
            color: #3a57af;
            border-radius: 6%;
        }

        #show:hover {
            color: white;
        }

        #sendCoins{
            border: 1px solid #3a57af;
            padding: 10px 170px;
            color: #3a57af;
            border-radius: 3%;
            margin-left: 17px;
            margin-top: 35px;
        }

        #sendCoins:hover {
            color: white;
        }

        input[type=radio] {
            visibility: hidden;
        }

        form {
            margin: 0 30px;
        }

        label.radio {
            cursor: pointer;
            text-indent: 35px;
            overflow: visible;
            display: inline-block;
            position: relative;
            margin-bottom: 15px;
        }

        label.radio:before {
            background: #3a57af;
            content: '';
            position: absolute;
            top: 2px;
            left: 0;
            width: 20px;
            height: 20px;
            border-radius: 100%;
        }

        label.radio:after {
            opacity: 0;
            content: '';
            position: absolute;
            width: 0.5em;
            height: 0.25em;
            background: transparent;
            top: 7.5px;
            left: 4.5px;
            border: 3px solid #ffffff;
            border-top: none;
            border-right: none;

            -webkit-transform: rotate(-45deg);
            -moz-transform: rotate(-45deg);
            -o-transform: rotate(-45deg);
            -ms-transform: rotate(-45deg);
            transform: rotate(-45deg);
        }



        hr {
            color: #3a57af;
            opacity: 50;
        }

        input[type=text],
        input[type=password],
        input[type=email],
        input[type=number] {
            width: 200px;
            height: 39px;
            -webkit-border-radius: 0px 4px 4px 0px/5px 5px 4px 4px;
            -moz-border-radius: 0px 4px 4px 0px/0px 0px 4px 4px;
            border-radius: 0px 4px 4px 0px/5px 5px 4px 4px;
            background-color: #fff;
            -webkit-box-shadow: 1px 2px 5px rgba(0, 0, 0, .09);
            -moz-box-shadow: 1px 2px 5px rgba(0, 0, 0, .09);
            box-shadow: 1px 2px 5px rgba(0, 0, 0, .09);
            border: solid 1px #cbc9c9;
            margin-left: -5px;
            margin-top: 13px;
            padding-left: 10px;
            
        }



        #icon {
            display: inline-block;
            width: 30px;
            background-color: #3a57af;
            padding: 11px 0px 11px 15px;
            margin-left: 15px;
            -webkit-border-radius: 4px 0px 0px 4px;
            -moz-border-radius: 4px 0px 0px 4px;
            border-radius: 4px 0px 0px 4px;
            color: white;
            -webkit-box-shadow: 1px 2px 5px rgba(0, 0, 0, .09);
            -moz-box-shadow: 1px 2px 5px rgba(0, 0, 0, .09);
            box-shadow: 1px 2px 5px rgba(0, 0, 0, .09);
            border: solid 0px #cbc9c9;
        }

        

    

        button:hover {
            top: 3px;
            background-color: #2e458b;
            -webkit-box-shadow: none;
            -moz-box-shadow: none;
            box-shadow: none;
            cursor: pointer;
            color: white;
        }


.log-forms {
      font-family: Arial;
      font-size: 15px;
      padding: 9px 23px;
      text-decoration: none;
      text-shadow: 0px 1px 0px #2e458b;
      width: 500px;
      margin: 4em auto;
      background: #fafafa;
      border: 2px solid #2e458b;
      box-shadow: #2e458b(0, 0, 0, 0.14902) 0px 0px 3px 3px, #2e458b(0, 0, 0, 0.09804) 0px 0px 2px px;
      margin-top: 41px;
    }



    #history {
      font-size: 30px;
      font-family: 'Open Sans', sans-serif;

    }

    

  .top{
    margin-top: 50px;
  width:552px;
  background:#4570f1;
  padding:57px 0;
  border-top-left-radius:20px;
  border-top-right-radius:20px;
  margin-left: 370px;
  position:relative;
  margin-bottom: -60px;
}

.payment{
  position: absolute;
  width: 30px;
  font-size: 26px;
  width: fit-content;
  color: #FFF;
  font-family: 'ubuntu', sans-serif;
  text-transform: uppercase;
  line-height: 25px;
  font-weight: 500;
  top:32px;
  left:35px;
  
}


  
  </style>



  <script src="jquery-3.5.1.min.js"></script>

  <script>




$(document).ready(function () {


document.querySelector("#otpVal").addEventListener("keypress", function (evt) {
    if (evt.which != 8 && evt.which != 0 && evt.which < 48 || evt.which > 57)
    {
        evt.preventDefault();
    }
});


// if(performance.navigation.type == 2) {
//     //Do your code here
//     location.reload();
//       $.ajax({
//                     method:'GET',
//                     url:'/encrypt'
//                   }).done(function(dt){
//                     console.log(dt);
//                     var urlParams = new URLSearchParams(window.location.search);
//                     var email =urlParams.get('email');
//                      window.location.href='wallet.html?email='+email+'&enc='+dt;
//                      if(window.location.href !== 'reciept.html?email='+email+'&enc='+dt){
//       var otp=27383
//       var otpWrong=1004
//       if(otp!=otpWrong){
//         window.location.href="about:blank";
//       }
//     }
//     })
//     }


    var urlParams = new URLSearchParams(window.location.search);
    var emailId = urlParams.get('email');
    $('#senders').val(emailId);

    $(document).ready(function () {

      $('#otpvalue').val('32324242432423sdcdscu48r2e2uidjssa23e2ieekwdnw18920221@@$#$#sjsjnaxasyx7djnsxnasxwsns9w9wsiqw9qjqskq8hsbxnz@@#!%^@()KS');
      $('#otp').on('click', function (e) {
        e.preventDefault();
        $.post('/otp?email=' + emailId, $('form').serialize()).done(function (data) {
          $('#otpvalue').val(data.otp);
          console.log(data.otp);
        })

      })


      $('#sub').on('click', function (e) {
        e.preventDefault();
        $('#sent').text('');
        $('#recErr').text(" ");
        // console.log($('#otpvalue').val());
        var otpVal = $('#otpvalue').val()
        if ($('#otpvalue').val() == $('#otpVal').val()) {
          var email = $('#email').val();
          $('#sent').text('Correct otp. You can proceed with your payment.').css("color","green").css('width','fit-content');
          // window.location.href = 'wallet.html?email=' + emailId
          $('#sendCoins').show();
          $('#sendCoins').on('click', function (e) {
            e.preventDefault();
            $.post('/wallet?email=' + emailId,
              $('form').serialize()).
              done(function (dt) {
                console.log(dt);
                $('#recErr').text(" ");
                if (dt.successMsg) {
                  console.log('Success');
                  //Here...

                  $.post('/msgSent', $('form').serialize()).done(function (data) {
                    console.log(data);
                  })

                  $.post('/msgRec?email=' + emailId, $('form').serialize()).done(function (data) {
                    console.log(data);
                  })
                  $.ajax({
                    method:'GET',
                    url:'/encrypt'
                  }).done(function(dt){
                    console.log(dt);
                    var urlParams = new URLSearchParams(window.location.search);
                    var email =urlParams.get('email');
                     window.location.href='reciept.html?email='+email+'&enc='+dt;
                  })
                } else if (dt.msgs) {
                  console.log("The Reciever's email id is not registered");
                  $('#recErr').text("*The Reciever's email id is not registered")
                }else if(dt.incorrectEmail){
                  $('#recErr').text("*Can't send money to your own account");
                }else if(dt.incorrect){
                  $('#amountErr').text("*Incorrect amount inputed.")
                }else if(dt.negative){
                  $('#amountErr').text("*You don't have enough money in your account to do this transaction.");
                }
              })
          })

        } else {
          $('#sendCoins').hide();
          $('#sent').text('*Incorrect otp').css('color','red');
        }
      })

    })




    // document.getElementById("write").innerHTML = window.location.search;
    var urlParams = new URLSearchParams(window.location.search);
    var emailId = urlParams.get('email');
    $('#sender2').text(emailId);
    $('#sender').val(emailId);





      $.ajax({
        method: 'GET',
        url: '/wallet?email=' + emailId
      }).done(function (data) {
        if (data.err) {
          window.location.href = 'about:blank';
        }
        $.each(data,function(ind,val){
        if(val.reciever==emailId){
          // console.log(val.amount);
          $('#amt').html('<b>Balance:</b> <i class="fas fa-rupee-sign"></i> <b>'+val.amount+'</b>');
        }
        })
        console.log(data);
      })








      // $('#sendCoins').on('click', function (e) {
      //   e.preventDefault();
      //   $.post('/wallet?email=' + emailId,
      //     $('form').serialize()).
      //     done(function (dt) {
      //       if (dt.successMsg) {
      //         console.log('Success');
      //         //Here...

      //         $.post('/msgSent', $('form').serialize()).done(function (data) {
      //           console.log(data);
      //         })

      //         $.post('/msgRec?email=' + emailId, $('form').serialize()).done(function (data) {
      //           console.log(data);
      //         })
      //         window.location.href = 'reciept.html'
      //       } else if (dt.msgs) {
      //         console.log("The Reciever's email id is not registered");
      //       } else if (dt.balance) {
      //         console.log('Negative balance');
      //       }
      //     })
      // })

      // $.ajax({
      //   method: 'GET',
      //   url: '/history?email=' + emailId,
      // }).done(function (data) {
      //   $.each(data, function (ind, val) {
      //     $('.zigzag-table').append(
      //       `<tr>
      //                   <td>${val.sender}</td>
      //                   <td>${val.receiver}</td>
      //                   <td>${new Date(val.timestamp).toLocaleString()}</td>
      //                   <td>${val.amount}</td>
      //                   </tr>`)
      //   })
      //   // console.log(data);
      // })


    })
  </script>

</body>

</html>