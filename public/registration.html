<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <p id="suc"></p>
    <form>
        <p id="otpPar"></p>
        <input type="text" name="name" placeholder="name"><br>
        <!-- autocomplete="none" -->
        <input type="email" id="email" name="email"  placeholder="email"  required>
        <button id='otp'>send otp</button><br>
        <input type="number" id="otpVal" placeholder="enter the otp">
        <input type="number" id="otpValue" hidden>
        <button id="sub">Submit</button><br>
        <input type="password" id="pass" name="pass" placeholder="password"   minlength="8" hidden required>
        <button id="show" hidden>show</button>
        <button id="reg" hidden>Register</button><br>
    </form>
    <!-- <br><hr><br>
    <button id="registration"><a href="registration.html">Register here</a></button> -->

    <script src="jquery-3.5.1.min.js"></script>
    <script>
        $(document).ready(function () {

            $('#otp').on('click', function (e) {
                e.preventDefault();
                $.post('/otpReg', $('form').serialize()).done(function (data) {
                    $('#otpValue').val(data.otp);
                    console.log(data)
                    console.log($('#otpValue').val());
                })
            })

            var regex = /^(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z])(?=.*[@$!%*?&])([a-zA-Z0-9@$!%*?&]{8,})$/
            // console.log(regex.test('Cooldude@24'));


            $('#sub').on('click', function (e) {
                e.preventDefault();
                // console.log($('#otpvalue').val());
                var otpVal = $('#otpvalue').val()
                if ($('#otpValue').val() == $('#otpVal').val()) {
                    $('#reg').show();
                    $('#pass').show();
                    $('#show').show();



                $('#show').on('click',function(e){
                    e.preventDefault();
                    let passType=$('#pass').attr('type');
                        if(passType=='password'){
                            $('#pass').attr('type','text');
                            // $('#show').html('<i class="fas fa-eye"></i>');
                            $('#show').text('hide');
                        }else{
                            $('#pass').attr('type','password');
                            // $(this).html('<i class="fas fa-eye-slash"></i>');
                            $('#show').text('show');
                        }
                })

                    $('#reg').on('click', function (e) {
                e.preventDefault();

                    if(regex.test($('#pass').val())){

                $.post('/email', $('form').serialize()).
                done(function(dt){
                    if(dt.Mail){
                $.post('/register', $('form').serialize()).done(function (dt) {
                    if (dt.insertedCount == 1) {
                        $('#suc').text("You've successfully registered.");
                        // $.post('/email', $('form').serialize());
                        setTimeout(function () {
                            window.location.href = 'login.html'
                        }, 1000);
                    } else if (dt.msg = 'Email is already in use') {
                        $('#suc').text(dt.msg);
                            
                    }
                    // console.log(dt.msg)
                })
            }else if(dt.sentAlready){
                console.log(dt.sentAlready);
            }else{
                console.log('Email id is not registered to gmail');
            }
            })
        }else{
            console.log(`Min 1 uppercase letter.
Min 1 lowercase letter.
Min 1 special character.
Min 1 number.
Min 8 characters.
Max 30 characters.`);
        }
            })
            
                } else {
                    $('#otpPar').text('Incorrect otp');
                }
            })
            

            

            // $('#reg').on('click', function (e) {
            //     e.preventDefault();

            //     $.post('/email', $('form').serialize()).
            //     done(function(dt){
            //         if(dt.Mail){
            //     $.post('/register', $('form').serialize()).done(function (dt) {
            //         if (dt.insertedCount == 1) {
            //             $('#suc').text("You've successfully registered.");
            //             // $.post('/email', $('form').serialize());
            //             setTimeout(function () {
            //                 window.location.href = 'login.html'
            //             }, 1000);
            //         } else if (dt.msg = 'Email is already in use') {
            //             $('#suc').text(dt.msg);
                            
            //         }
            //         // console.log(dt.msg)
            //     })
            // }else if(dt.sentAlready){
            //     console.log(dt.sentAlready);
            // }else{
            //     console.log('Email id is not registered to gmail');
            // }
            // })

            // })


        })
    </script>



</body>

</html>